#!/usr/bin/env bash

# $1 : dir
# $2 : indent size

makepretty(){
    tr '-' ' ' | awk '{$0=toupper(substr($0,1,1)) substr($0,2)} 1'
}

_tree () {
    _tab () { test -n "$1" && printf "%$1c" 1 | tr '1' ' ' ; }

    local dir="${1:-.}"
    local indent="$2"

    # pretty page name
    _tab "$indent" ; echo "${indent:+- }name: $(echo ${dir##*/} | makepretty)"

    # path relative to site root
    _tab "$indent" ; echo "${indent:+  }path: $(echo $dir | sed 's/^\.//')"

    # content
    empty=true
    for entry in "$dir"/*
    do
        if test -d "$entry" && ! test -e "$entry/.hide" ; then
            $empty && {
                _tab "$indent" ; echo "${indent:+  }contents:"
                indent="$(($indent + 2))"
                empty=false
            }
            $0 "$entry" "$indent"
        fi
    done
}

_tree "$@"
